var imagePath=base_url+"assets/images/";var personId="";var personHasAlreadyChosen=false;var gameId="";var correctAccessCode="";var chosenPerson;function ucFirst(a){return a.charAt(0).toUpperCase()+a.slice(1)}function chooseYourselfDropdownListener(b,a,c){b.change(function(){personId=b.find("option:selected").val();gameId=b.find("option:selected").data("game-id");var d=b.find("option:selected").data("token");if(d!==-1){personHasAlreadyChosen=true}var e=b.find("option:selected").data("image");correctAccessCode=b.find("option:selected").data("access-code");updateImage(imagePath+e+".jpg",c);updateAccessCodeControl(a,e);enableOrDisableAccessCodeInput(personId,a)})}function updateImage(b,a){a.attr("src",b)}function updateAccessCodeControl(a,b){a.val("");if(b!="empty"){a.attr("placeholder","Code")}else{a.attr("placeholder","")}}function enableOrDisableAccessCodeInput(b,a){if(parseInt(b)>0){a.removeAttr("disabled")}else{a.attr("disabled","disabled")}}function accessCodeInputListener(a,b,d,c,e){a.keyup(function(){var f=$(this).val();if(f.length===4){if(parseInt(f)===correctAccessCode){if(personHasAlreadyChosen){c.hide();d.hide();e.show()}else{b.removeAttr("disabled");b.html("Start !")}}else{b.attr("disabled","disabled");b.html("")}}})}function showPossiblePersons(d,e,c,b,a){$.ajax({type:"POST",url:site_url+"/game/ajaxGetRandomPerson",data:{currentPersonId:d,gameId:e},dataType:"json",success:function(g){var l=g.allPersonsImageNames;var j=l.length;chosenPerson=g.randomPerson;var k;var h=0;var f=0;var m=0;for(k=0;k<16;k++){setTimeout(function(){f=Math.floor(Math.random()*(j-1));while(f===m){f=Math.floor(Math.random()*(j-1))}m=f;updateImage(imagePath+l[f]+".jpg",c)},h);h+=250}setTimeout(function(){updateImage(imagePath+chosenPerson.image+".jpg",c);var i="";if(chosenPerson.nickname===chosenPerson.name){i="You picked "+ucFirst(chosenPerson.name)+" "+ucFirst(chosenPerson.lastname)+"!"}else{i='You picked "'+ucFirst(chosenPerson.nickname)+'" aka '+ucFirst(chosenPerson.name)+" "+ucFirst(chosenPerson.lastname)+"!"}var n="";if(chosenPerson.isMale){n="You can surprise him with a gift of € 20."}else{n="You can surprise her with a gift of € 20."}a.find("p.result").html(i);a.find("p.result-ps").html(n);b.hide();a.show()},4000)},error:function(h,f,g){console.log("-- ERROR IN AJAX --\n\n"+h.responseText)}})}function startButtonListener(c,e,b,a,d){c.click(function(){e.hide();b.show();showPossiblePersons(personId,gameId,d,b,a)})}$(document).ready(function(){var a=$("#select-yourself-dropdown");var e=$("input#accessCode");var j=$("img.img-person-that-will-choose");var i=$("img.img-choosen-person");var c=$("button#start-game");var g=$("div.image-wrapper");var d=$("div.controls-wrapper");var b=$("div.message-wrapper");var f=$("div.result-wrapper");var h=$("div.error-wrapper");chooseYourselfDropdownListener(a,e,j);accessCodeInputListener(e,c,g,d,h);startButtonListener(c,d,b,f,i)});